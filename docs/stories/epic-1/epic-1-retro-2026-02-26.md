# Epic 1 Retrospective â€” Foundation & Administration
**Date:** 2026-02-26
**Facilitator:** Bob (Scrum Master)
**Participants:** Bob (SM), Alice (Product Owner), Charlie (Senior Dev), Dana (QA Engineer), Elena (Junior Dev), Winston (Architect), Murat (TEA), Azfar (Project Lead)
**Epic Status at Retro:** 13/13 stories done â€” all exit criteria met

---

## Epic 1 Summary

| Metric | Value |
|--------|-------|
| Stories Delivered | 13 / 13 (100%) |
| Exit Criteria Met | 6 / 6 |
| Code Review Pass (1st attempt) | 0 / 13 â€” all stories had CHANGES REQUESTED |
| Total Bugs Fixed in Code Review | 18 (16 real, 2 false positives confirmed) |
| Most Recurring Bug Class | Non-atomic Redis rate limiting (5 helpers, 3 routers) |
| Technical Debt Carried Forward | ~6 items (avatar thumbnail, placeholder metrics, SAML deferred, test coverage backlog) |

---

## Exit Criteria Verification (Gate for Epic 2)

| # | Criterion | Status |
|---|-----------|--------|
| 1 | All 13 stories complete â€” ACs met | âœ… Done |
| 2 | Demo-able onboarding (signup â†’ org â†’ invite â†’ project <10 min) | âœ… Done |
| 3 | Multi-tenant isolation validated â€” 3 test tenants, zero data leakage | âœ… Done |
| 4 | Regression tests passing â€” auth, RBAC, project CRUD | âœ… Done |
| 5 | Deployed to staging | âœ… Done |
| 6 | Documentation updated â€” README + API docs for auth endpoints | âœ… Done |

**Epic 2 kickoff is cleared.**

---

## What Went Well

- **100% story delivery** â€” 13/13 stories with full AC coverage
- **Consistent three-tier test coverage** â€” unit, integration, and security suites for every story without exception
- **Mock-based integration approach** â€” no live DB dependency; fast, reliable CI runs; solid investment for Epic 2
- **Schema-per-tenant architecture** â€” held up perfectly across all 13 stories; no isolation issues
- **Audit service design** â€” in-transaction + async fire-and-forget pattern was architecturally sound
- **RBAC system** â€” `require_role` / `require_project_role` pattern scaled cleanly across all endpoints
- **Code review process caught real, ship-stopping bugs** â€” missing server-side delete confirmation, wrong audit columns, non-atomic rate limit would all have been production incidents

---

## Root Causes â€” What Went Wrong

### Root Cause 1 â€” TypeScriptâ†’Python Transition Not Fully Absorbed (PRIMARY)

The DEV agent scaffolded `backend/` in TypeScript/Express during Epic 0 (Story 0-11 health probe). The sprint-change-proposal (2026-02-20) declared the correction resolved. However, the DEV agent carried forward incomplete Python/FastAPI mental models into Epic 1 story implementation.

**Evidence of residual confusion:**
- Non-atomic Redis `INCR + separate expire` pattern â€” idiomatic in Node.js `ioredis`; wrong in `redis-py`
- `_audit_member_op` using `actor_id`/`actor_email` (TypeScript ORM-style naming) instead of `actor_user_id`/`tenant_id` (SQLAlchemy raw SQL DDL naming)
- `auto_assign_creator` called unconditionally without checking migration order â€” a Python/Alembic dependency model not carried over from TypeScript migration patterns
- authProvider `useState('local')` flash bug â€” async state initialization pattern not translated correctly

**Azfar's finding:** The 18 bugs found in code review are not 18 independent mistakes. They are downstream symptoms of an unresolved context gap from the technology switch. Had the foundation been aligned, the majority of those 18 bugs would not have occurred.

---

### Root Cause 2 â€” Batch Code Review Amplified Every Mistake

Stories 1-6 through 1-12 were reviewed together at the end of the sprint. The non-atomic Redis pattern was introduced in Story 1-9, propagated undetected to 1-10, 1-11, and 1-12 before the batch review ran. Four-story propagation of a single pattern bug.

Had rolling per-story review been in place, the pattern would have been caught at Story 1-9 and corrected before 1-10 began.

---

### Root Cause 3 â€” Self-Certification of Verify-Tasks

Story 1-11 Task 7.4: *"Verify delete confirmation cannot be bypassed (server validates, not just client)"* â€” checked as complete by the implementer. Client-side validation existed; server-side did not. The checkbox mapped to what the developer had built, not to what the acceptance criterion required.

---

### Root Cause 4 â€” Tests Verified Execution, Not Behaviour

Three failure modes identified:

| Type | Example | Why It Passed |
|------|---------|---------------|
| Execution verified, not outcome | Email notification test 2 | Async exception swallowed silently; code ran, outcome not asserted |
| Mock masked real pattern bug | Rate limit tests | Mock returned controlled values; real race condition never exercised |
| Task self-certified | Story 1-11 Task 7.4 | Developer confirmed client-side, mentally mapped to task |

---

### Root Cause 5 â€” No Repo-State Readiness Check

The Implementation Readiness workflow (score 8.7/10) validated document alignment: PRD â†” Architecture â†” Stories. It did not validate repo state alignment with architectural decisions. The TypeScript scaffold existed in `backend/` while all planning documents specified Python/FastAPI. No automated or manual check caught this gap before Story 1-1 implementation began.

---

## Previous Epic Comparison (Epic 0 â†’ Epic 1)

| Epic 0 Lessons | Applied in Epic 1? |
|----------------|-------------------|
| replaceAll over replace | âœ… Applied |
| Output parity between clouds | âœ… Applied |
| Alpine lacks curl | âœ… Applied |
| Mid-sprint corrections can be absorbed | âœ… â€” but correction was declared resolved before it was fully absorbed |

**Key continuity insight:** Epic 0 taught us that mid-sprint corrections are manageable. Epic 1 revealed that a correction declared resolved is not the same as a correction fully absorbed. The transition correction needs to be validated through implementation output, not through a decision memo.

---

## Action Items

| # | Action Item | Owner | Deadline | Success Criteria |
|---|-------------|-------|----------|-----------------|
| A1 | **Repo Readiness Check** â€” `grep -r "import express\|\.ts$" backend/` returns zero hits | Charlie | Before Story 2-1 | Zero TypeScript/Express residuals in `backend/` |
| A2 | **Pattern-First Story Context** â€” Epic 2 context XMLs require `<patterns>` section with working code snippet | Bob | Before Story 2-1 ready-for-dev | No context XML approved without patterns section |
| A3 | **Rolling Code Review** â€” per-story review; next story cannot start until prior review is closed and merged | Bob + Azfar | Effective immediately | Zero batch reviews in Epic 2 |
| A4 | **4 Pattern Spikes** â€” LLM call (with cost tracking + tenant isolation), vector embedding insert/query, streaming SSE response, Playwright DOM crawl | Winston (design) + Charlie (implement) | Before Story 2-1 | 4 spike files in `backend/src/patterns/` with passing contract tests |
| A5 | **DoD Update** â€” add "patterns match spike" as explicit checkbox equal to "tests pass" | Bob | Before Story 2-1 drafted | New DoD visible in Story 2-1 template |
| A6 | **Test Intention Rule** â€” every test has one-line comment stating behaviour proved, not code called | Dana | From Story 2-1 | Enforced in code review checklist |
| A7 | **Contract Tests for Infrastructure Patterns** â€” new infrastructure patterns require contract test against real service before mocks are acceptable | Murat | Alongside A4 spikes | 4 contract tests covering Epic 2 pattern spikes |
| A8 | **Verify-Tasks Require Independent Sign-off** â€” tasks containing "verify," "cannot be bypassed," "validate" require confirmation by someone other than implementer | Bob | Before Story 2-1 drafted | Zero self-certified verify-tasks in Epic 2 |

**Azfar's explicit commitment on A3:** Rolling review confirmed â€” no story advances while prior review is open.

---

## Epic 2 Critical Path (Must Complete Before Story 2-1 Starts)

| Priority | Item | Owner |
|----------|------|-------|
| ðŸ”´ C1 | Repo Readiness Check (A1) | Charlie |
| ðŸ”´ C2 | 4 Pattern Spikes + Contract Tests (A4 + A7) | Winston + Charlie + Murat |
| ðŸ”´ C3 | Epic 2 Tech Context (SM workflow) | Bob |
| ðŸ”´ C4 | Updated DoD + story template (A5 + A8) | Bob |

---

## Significant Discovery for Epic 2

**Epic 2 introduces entirely new pattern classes with no existing codebase precedent:**
- LLM API calls with cost tracking and tenant context isolation
- Vector embedding insert/query (pgvector or external vector store)
- Streaming SSE responses for agent execution progress
- Playwright DOM crawling as a managed subprocess
- JIRA API bi-directional integration

**Risk:** If Pattern Spikes (A4) are not completed before Story 2-1, Epic 2 will replicate the Epic 1 context gap â€” but with a Critical risk rating and real LLM API costs attached to every incorrect pattern.

**Recommendation:** Epic 2 Story 1 (`2-1-document-upload-parsing`) should NOT be marked ready-for-dev until all four pattern spikes are committed, reviewed, and their contract tests are passing.

---

## Commitments Summary

- **8 action items** with named owners
- **4 critical path items** blocking Epic 2 Story 1
- **1 explicit project lead commitment** â€” rolling code review (A3), Azfar confirmed
- **Epic 2 kickoff gate** â€” cleared on all 6 exit criteria

---

## Closing Note

Epic 1 delivered a complete, production-grade multi-tenant foundation: auth, RBAC, MFA, projects, audit, analytics, data export, and org deletion. The architecture decisions â€” schema-per-tenant, JWT+Redis sessions, Argon2id hashing, atomic Lua rate limiting â€” are sound and will support Epic 2's AI workloads.

The lessons from this retrospective are not about code quality failure. They are about **context alignment failure** â€” the gap between what was decided in documents and what was understood in implementation. Closing that gap is the single most valuable thing this team can do before Epic 2 begins.

---

*Retrospective facilitated by Bob (SM) | Documented 2026-02-26*
*Next: Epic 2 â€” AI Agent Platform & Executive Visibility*
